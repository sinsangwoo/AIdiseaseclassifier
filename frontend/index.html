<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI 기반 흉부 X-ray 폐렴 진단 시스템 - 의료 영상을 업로드하여 실시간 분석 결과를 확인하세요">
    <meta name="keywords" content="AI, 폐렴 진단, 의료 영상, X-ray, 딥러닝, 헬스케어">
    <meta name="author" content="신상우 (30814)">
    <meta name="theme-color" content="#007bff">

    <title>Smart Medical AI | 폐렴 진단 솔루션</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🫁</text></svg>">

    <!-- ✅ 환경변수 주입 포인트 (GitHub Actions에서 치환) -->
    <script>
        window.ENV = {
            API_URL: '${VITE_API_URL}' || '',
            ENVIRONMENT: '${VITE_ENV}' || 'production'
        };
    </script>

    <!-- CSS Modules -->
    <link rel="stylesheet" href="./css/components/variables.css">
    <link rel="stylesheet" href="./css/components/layout.css">
    <link rel="stylesheet" href="./css/components/typography.css">
    <link rel="stylesheet" href="./css/components/button.css">
    <link rel="stylesheet" href="./css/components/card.css">
    <link rel="stylesheet" href="./css/components/upload.css">
    <link rel="stylesheet" href="./css/components/progress.css">
    <link rel="stylesheet" href="./css/components/notice.css">

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        crossorigin="anonymous">

    <!-- External Libraries (for report saving) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
</head>

<body>
    <!-- Main Application Container -->
    <main class="container" role="main">

        <!-- 1. Header Section -->
        <header class="section mb-xl">
            <div class="text-center">
                <div class="mb-sm">
                    <span class="text-small text-uppercase text-primary text-bold" style="letter-spacing: 2px;">Medical
                        AI Solution</span>
                </div>
                <h1 class="heading-1 mb-sm">
                    <i class="fa-solid fa-lungs-virus text-primary" aria-hidden="true"></i>
                    <span>AI 폐렴 진단 시스템</span>
                </h1>
                <p class="subtitle text-large">
                    딥러닝 알고리즘을 활용한 흉부 X-ray 실시간 정밀 분석
                </p>
                <div class="flex-center gap-sm mt-md">
                    <span class="text-tiny text-muted bg-gray-100 p-sm" style="border-radius: 20px; padding: 4px 12px;">
                        <i class="fa-solid fa-code-branch"></i> v7.0.0
                    </span>
                    <span class="text-tiny text-muted bg-gray-100 p-sm" style="border-radius: 20px; padding: 4px 12px;">
                        <i class="fa-solid fa-user-doctor"></i> Dev: 신상우
                    </span>
                </div>
            </div>
        </header>

        <div class="section-divider" aria-hidden="true"></div>

        <!-- 2. Workflow Section -->
        <div class="grid grid--1-col gap-xl">

            <!-- Step 1: Image Upload -->
            <section aria-labelledby="upload-heading">
                <div class="flex-between mb-md">
                    <h3 id="upload-heading" class="heading-4 mb-0">
                        <span class="text-primary mr-sm">01.</span>영상 업로드
                    </h3>
                    <span class="text-tiny text-muted"><i class="fa-solid fa-circle-info"></i> JPG, PNG 지원</span>
                </div>

                <div class="upload-section upload" id="uploadSection" role="button" tabindex="0"
                    aria-label="X-ray 이미지 업로드 영역"
                    onkeypress="if(event.key==='Enter') document.getElementById('imageInput').click()">

                    <div class="upload__icon">
                        <i class="fa-solid fa-cloud-arrow-up" aria-hidden="true"></i>
                    </div>
                    <div class="upload__text text-large">
                        X-ray 이미지를 이곳에 드래그하세요
                    </div>
                    <div class="upload__subtext mb-md">
                        또는 클릭하여 파일을 선택하십시오
                    </div>
                    <div class="upload__formats">
                        <i class="fa-solid fa-shield-halved"></i>
                        <span>의료 데이터 보안 프로토콜 적용됨</span>
                    </div>
                </div>

                <input type="file" id="imageInput" accept="image/jpeg,image/png,image/jpg" hidden>
            </section>

            <!-- Step 2: Preview & Analysis -->
            <div id="previewContainer" class="preview-container preview hidden">
                <section aria-labelledby="preview-heading" class="card card--bordered p-lg">
                    <h3 id="preview-heading" class="heading-4 text-center mb-lg">
                        <span class="text-primary mr-sm">02.</span>영상 확인 및 분석
                    </h3>

                    <div class="grid grid--2-cols gap-lg" style="align-items: center;">
                        <div class="card__image-container">
                            <img id="imagePreview" class="preview__image" alt="업로드된 X-ray 미리보기">
                            <div class="card__image-label">
                                <i class="fa-solid fa-microscope"></i> Analysis Ready
                            </div>
                        </div>

                        <div class="flex-column gap-md">
                            <div class="notice notice--info notice--small mb-md">
                                <i class="notice__icon fa-solid fa-circle-info"></i>
                                <div class="notice__content">
                                    <strong>분석 준비 완료</strong><br>
                                    이미지가 정상적으로 로드되었습니다. 아래 버튼을 눌러 AI 진단을 시작하세요.
                                </div>
                            </div>

                            <div class="agreement-box agreement agreement--visible" id="agreementBox">
                                <input type="checkbox" id="agreeCheckbox" class="agreement__checkbox">
                                <label for="agreeCheckbox" class="agreement__label text-small">
                                    본 결과는 보조적 수단이며, 전문의의 진단을 대체할 수 없음에 동의합니다.
                                </label>
                            </div>

                            <div class="btn-group btn-group--start mt-md">
                                <button id="analyzeBtn" class="btn btn--primary btn--large btn--block" type="button"
                                    disabled>
                                    <i class="btn__icon fa-solid fa-brain"></i>
                                    <span>AI 정밀 분석 시작</span>
                                </button>
                                <button id="clearBtn" class="btn btn--secondary btn--outline btn--block" type="button">
                                    <i class="btn__icon fa-solid fa-rotate-left"></i>
                                    <span>다시 선택</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Step 3: Progress Indicator -->
            <section id="progressContainer" class="progress-container hidden" aria-live="polite">
                <div class="card card--glass p-xl text-center">
                    <div class="spinner spinner--pulse spinner--large mb-lg"></div>
                    <h3 class="heading-3 mb-sm">AI 분석 진행 중...</h3>
                    <p class="text-muted mb-lg">딥러닝 모델이 흉부 영상을 분석하고 있습니다.</p>

                    <div class="progress-bar progress--gradient progress--ai-analyzing">
                        <div class="progress-bar-fill" id="progressBarFill"></div>
                    </div>
                    <div class="flex-between mt-sm">
                        <span class="text-tiny text-muted">Data Preprocessing</span>
                        <span class="text-tiny text-muted">Feature Extraction</span>
                        <span class="text-tiny text-muted">Classification</span>
                    </div>
                </div>
            </section>

            <!-- Step 4: Diagnostic Report -->
            <section id="reportContainer" class="report-container hidden" aria-labelledby="report-heading">
                <div class="flex-between mb-md align-items-end">
                    <h3 id="report-heading" class="heading-4 mb-0">
                        <span class="text-primary mr-sm">03.</span>진단 리포트
                    </h3>
                    <span class="text-tiny text-muted" id="reportTimestamp"></span>
                </div>

                <article class="card card--report card--elevated" id="reportCard">
                    <header class="card__header card__header--accent flex-between">
                        <div class="flex-center gap-sm">
                            <i class="fa-solid fa-file-medical text-primary text-large"></i>
                            <span class="text-bold text-large">AI Diagnosis Result</span>
                        </div>
                        <div class="text-tiny text-muted bg-white p-sm"
                            style="border-radius: 4px; border: 1px solid var(--color-border-light);">
                            ID: <span id="reportId">REQ-2026-AI</span>
                        </div>
                    </header>

                    <div class="card__body card__body--divided">
                        <section class="card__section" style="flex: 1;">
                            <h4 class="card__section-title">분석된 영상</h4>
                            <div id="reportImageContainer" class="card__image-container">
                                <img id="reportImage" class="preview__image" alt="분석된 X-ray 원본">
                            </div>
                            <p class="text-tiny text-center text-muted mt-sm">
                                * AI가 주요 특징을 추출하여 분석한 원본 이미지입니다.
                            </p>
                        </section>

                        <section class="card__section" style="flex: 1.2;">
                            <h4 class="card__section-title">상세 분석 결과</h4>

                            <div id="resultsContent" class="grid gap-sm mb-lg"></div>

                            <div id="resultComment" class="notice notice--diagnosis notice--info" role="alert"></div>
                        </section>
                    </div>

                    <footer class="card__footer bg-gray-100 flex-between">
                        <div class="text-tiny text-muted flex-center gap-sm">
                            <i class="fa-solid fa-shield-halved"></i>
                            개인정보 보호를 위해 분석 후 데이터는 즉시 파기됩니다.
                        </div>
                        <div class="btn-group btn-group--end gap-sm m-0">
                            <button id="savePngBtn" class="btn btn--success btn--small btn--outline">
                                <i class="fa-solid fa-file-image"></i> PNG 저장
                            </button>
                            <button id="savePdfBtn" class="btn btn--success btn--small">
                                <i class="fa-solid fa-file-pdf"></i> PDF 리포트
                            </button>
                        </div>
                    </footer>
                </article>
            </section>

        </div>

        <div class="section-divider" aria-hidden="true"></div>

        <!-- Footer Section -->
        <footer class="section mt-xl">
            <div class="notice-box notice--warning notice--medical-warning mb-lg">
                <i class="notice__icon fa-solid fa-triangle-exclamation"></i>
                <div class="notice__content">
                    <strong class="notice__title">의료적 주의사항</strong>
                    <p class="mb-0">이 시스템은 <strong>교육 및 연구 목적</strong>으로 개발되었습니다. 제공되는 분석 결과는 참고용이며, 실제 환자의 진단 및 치료 결정은
                        반드시 전문 의료진과의 상담을 통해 이루어져야 합니다.</p>
                </div>
            </div>

            <div class="text-center text-muted">
                <p class="text-small mb-xs">
                    <i class="fa-solid fa-code"></i> Developed by <strong>신상우 (30814)</strong>
                </p>
                <p class="text-tiny opacity-75">
                    © 2026 Smart Medical Diagnosis System. All rights reserved.
                </p>
            </div>
        </footer>

    </main>

    <!-- ✅ ES6 Module 방식으로 앱 로드 -->
    <script type="module" src="js/app.js"></script>
</body>

</html>